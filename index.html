<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–æ–≤–æ—Ä—è—â–∏–π –∞–≤–∞—Ç–∞—Ä</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #120C1C; --surface: #1E1234; --primary: #A450F3; --accent: #F72585; --text: #EAE2FF; --border: #3A2E59; --input-bg: #0b0711; }
        * { box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        
        #editor-container { max-width: 1000px; width: 100%; background-color: var(--surface); padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid var(--border); }
        h1 { text-align: center; margin-bottom: 30px; text-shadow: 0 0 10px var(--accent); }
        .editor-layout { display: flex; flex-wrap: wrap; gap: 30px; }
        .col { flex: 1; min-width: 320px; display: flex; flex-direction: column; gap: 15px; }
        
        /* Preview */
        #preview-box {
            position: relative;
            background-image: linear-gradient(45deg, #181818 25%, transparent 25%), linear-gradient(-45deg, #181818 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #181818 75%), linear-gradient(-45deg, transparent 75%, #181818 75%);
            background-size: 20px 20px; background-color: #222; border: 1px dashed #555; border-radius: 20px;
            overflow: hidden; width: 100%; height: 550px; display: flex; justify-content: center; align-items: center;
        }
        
        .widget-wrapper { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; position: relative; }
        
        /* Avatar UI Styles */
        .avatar-ring { width: 100px; height: 100px; border-radius: 50%; border: 3px solid var(--border); background: var(--bg); cursor: pointer; position: absolute; z-index: 10; display: flex; justify-content: center; align-items: center; transition: 0.3s; }
        .avatar-ring:hover { transform: scale(1.05); }
        .avatar-ring img { width: 90%; height: 90%; border-radius: 50%; object-fit: cover; }
        
        .chat-window { width: 90%; height: 90%; background: var(--bg); border: 1px solid var(--border); border-radius: 20px; display: flex; flex-direction: column; position: absolute; z-index: 20; opacity: 0; pointer-events: none; transform: scale(0.9); transition: all 0.3s; box-shadow: 0 10px 50px rgba(0,0,0,0.7); }
        .chat-window.open { opacity: 1; pointer-events: all; transform: scale(1); }
        
        .chat-header { padding: 15px; background: rgba(255,255,255,0.05); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        .header-info { display: flex; align-items: center; gap: 10px; font-weight: 600; }
        .header-avatar { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; }
        .close-btn { background: none; border: none; color: #aaa; cursor: pointer; font-size: 24px; line-height: 1; }
        
        .chat-messages { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .message { display: flex; align-items: flex-end; gap: 8px; max-width: 85%; }
        .msg-avatar { width: 28px; height: 28px; border-radius: 50%; object-fit: cover; flex-shrink: 0; }
        .bubble { padding: 10px 14px; border-radius: 18px; font-size: 0.9rem; line-height: 1.4; word-wrap: break-word; }
        
        .msg-bot { align-self: flex-start; }
        .msg-bot .bubble { background: rgba(255,255,255,0.1); border-bottom-left-radius: 2px; }
        .msg-user { align-self: flex-end; flex-direction: row-reverse; }
        .msg-user .bubble { background: var(--accent); color: white; border-bottom-right-radius: 2px; }
        
        /* PDF Bubble Style */
        .pdf-bubble { display: flex; align-items: center; gap: 10px; background: #3A2E59 !important; border: 1px solid #A450F3; cursor: pointer; transition: 0.2s; text-decoration: none; color: white; }
        .pdf-bubble:hover { background: #A450F3 !important; }
        .pdf-icon { font-size: 20px; }

        .chat-input-area { padding: 15px; background: rgba(0,0,0,0.2); border-top: 1px solid var(--border); display: flex; gap: 10px; }
        .chat-input { flex: 1; background: var(--input-bg); border: 1px solid var(--border); border-radius: 20px; padding: 10px 15px; color: white; outline: none; }
        .send-btn { background: var(--accent); border: none; width: 40px; height: 40px; border-radius: 50%; cursor: pointer; display: flex; justify-content: center; align-items: center; transition: 0.2s; }
        .send-btn:hover { transform: scale(1.1); }
        .send-btn svg { width: 18px; fill: white; margin-left: 2px; }

        /* Settings */
        .custom-file { padding: 12px; background: rgba(0,0,0,0.2); border: 1px dashed var(--border); text-align: center; cursor: pointer; border-radius: 8px; position: relative; margin-bottom: 10px; }
        .file-input { position: absolute; top:0; left:0; width:100%; height:100%; opacity:0; cursor:pointer; }
        
        input[type="text"], input[type="url"], select { width: 100%; padding: 10px; background: var(--input-bg); border: 1px solid var(--border); border-radius: 8px; color: white; }
        input[type="color"] { width: 100%; height: 40px; border: none; background: none; cursor: pointer; }
        
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; background: linear-gradient(90deg, #A450F3, #F72585); color: white; font-weight: 600; cursor: pointer; margin-top: 10px; }
        
        textarea.dict-input { width: 100%; height: 150px; background: #0b0711; border: 1px solid var(--border); color: #fff; border-radius: 8px; padding: 10px; resize: vertical; font-family: monospace; white-space: pre; overflow: auto; }
        textarea.code-output { width: 100%; height: 80px; background: #0b0711; border: 1px solid var(--border); color: #888; border-radius: 8px; padding: 10px; resize: none; font-size:11px;}
        
        .hint { font-size: 0.8rem; color: #aaa; margin-top: -5px; line-height: 1.4; }
        .status-ok { color: #4ade80; font-weight: bold; font-size: 0.8rem; display: none; margin-top: 5px; }
    </style>
</head>
<body>

<div id="editor-container">
    <h1>–ì–æ–≤–æ—Ä—è—â–∏–π –∞–≤–∞—Ç–∞—Ä</h1>
    <div class="editor-layout">
        <!-- Preview -->
        <div class="col" style="flex: 1.5;">
            <div id="preview-box">
                <div class="widget-wrapper">
                    <!-- Ring -->
                    <div class="avatar-ring" id="prev-ring" onclick="toggleChat()">
                        <img id="prev-img-ring" src="">
                    </div>
                    <!-- Chat -->
                    <div class="chat-window" id="prev-chat">
                        <div class="chat-header">
                            <div class="header-info">
                                <img id="prev-img-head" class="header-avatar" src="">
                                <span id="prev-name">–ê–≤–∞—Ç–∞—Ä</span>
                            </div>
                            <button class="close-btn" onclick="toggleChat()">√ó</button>
                        </div>
                        <div class="chat-messages" id="prev-msgs"></div>
                        <div class="chat-input-area">
                            <input type="text" class="chat-input" id="prev-in" placeholder="–ù–∞–ø–∏—à–∏ –æ—Ç–≤–µ—Ç...">
                            <button class="send-btn" onclick="simSend()"><svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg></button>
                        </div>
                    </div>
                </div>
            </div>
            <p style="text-align:center; color:#888; font-size:0.9rem; margin-top:5px;">–ù–∞–ø–∏—à–∏—Ç–µ —Å–ª–æ–≤–æ –∏–∑ —Å–ø–∏—Å–∫–∞ –∑–∞–¥–∞–Ω–∏–π, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å.</p>
        </div>

        <!-- Settings -->
        <div class="col">
            <label class="custom-file">
                <span id="label-img">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å –ê–≤–∞—Ç–∞—Ä (Image)</span>
                <input type="file" id="inp-img" accept="image/*" class="file-input">
            </label>

            <span style="font-weight:600; margin-top:10px; display:block">–ó–∞–¥–∞–Ω–∏—è:</span>
            
            <label class="custom-file" style="border-color: #A450F3; background: rgba(164, 80, 243, 0.1);">
                <span id="label-pdf">üìé –ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å PDF —Ñ–∞–π–ª (–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</span>
                <input type="file" id="inp-pdf" accept="application/pdf" class="file-input">
                <div id="status-pdf" class="status-ok">–§–∞–π–ª –∑–∞–≥—Ä—É–∂–µ–Ω!</div>
            </label>
            <div class="hint">–§–∞–π–ª –ø–æ—è–≤–∏—Ç—Å—è –∫–∞–∫ –∫–Ω–æ–ø–∫–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≤ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–∏. –ú–∞–∫—Å 2–ú–ë.</div>

            <span style="font-weight:600; display:block; margin-top:10px">–¢–µ–∫—Å—Ç–æ–≤—ã–µ –ó–∞–¥–∞–Ω–∏—è (–ë–∞–∑–∞):</span>
            <div class="hint">–ü–∞—Ä—ã: <b>–í–æ–ø—Ä–æ—Å - –û—Ç–≤–µ—Ç</b> (—Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏).</div>
            <textarea id="inp-dict" class="dict-input" placeholder="–ó–∞–¥–∞–Ω–∏–µ 1 - –†–µ—à–∏ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ 2+2=4
–°—Ç–æ–ª–∏—Ü–∞ –§—Ä–∞–Ω—Ü–∏–∏ - –ü–∞—Ä–∏–∂
–ü—Ä–∏–≤–µ—Ç - –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π!
PDF - –°–∫–∞—á–∞–π —Ñ–∞–π–ª –≤—ã—à–µ."></textarea>
            
            <span style="font-weight:600">–û—Ç–≤–µ—Ç, –µ—Å–ª–∏ –Ω–µ—Ç –≤ –±–∞–∑–µ:</span>
            <input type="text" id="inp-unknown" value="–ù–µ–≤–µ—Ä–Ω–æ –∏–ª–∏ —è –Ω–µ –∑–Ω–∞—é. –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑.">

            <span style="font-weight:600">–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ:</span>
            <input type="text" id="inp-welcome" value="–ü—Ä–∏–≤–µ—Ç! –£ –º–µ–Ω—è –µ—Å—Ç—å –¥–ª—è —Ç–µ–±—è –∑–∞–¥–∞–Ω–∏–µ.">

            <span style="font-weight:600">–¶–≤–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π:</span>
            <input type="color" id="inp-accent" value="#F72585">
            
            <button id="btn-copy" class="btn">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥</button>
            <textarea id="output-code" class="code-output" readonly placeholder="–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –≥–æ—Ç–æ–≤—ã–π –∫–æ–¥..."></textarea>
        </div>
    </div>
</div>

<script>
    // Sounds (Base64 short placeholders)
    // Click (Typewriter)
    const sndType = "data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWgAAAA0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMmYXbWxpbmUAbXAzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq//uQZAAP8AAAaQAAAAgAAA0gAAABAAABpAAAACAAADSAAAAEqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq"; // Placeholder: In real code, this would be a short click sound
    // Notification (Ping)
    const sndPing = "data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWgAAAA0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMmYXbWxpbmUAbXAzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq"; 

    // Better sounds (Short URI encoded for demo logic)
    // Actually using dummy data above to save space in preview, but logic handles playing.
    // For the final code, I will inject real short sounds.

    const realClick = "data:audio/wav;base64,UklGRi4AAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAACAgEBAQAAAA=="; // Very short click
    const realPing = "data:audio/wav;base64,UklGRjQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQcAAAAAAP8A/wD/AP8A/wD/AP8AAA=="; // Very short ping
    
    // Default Assets
    const defBot = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23cccccc'%3E%3Cpath d='M12 2a2 2 0 0 1 2 2c0 .74-.4 1.39-1 1.73V7h1a7 7 0 0 1 7 7h1a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1h-1v1a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-1H2a1 1 0 0 1-1-1v-3a1 1 0 0 1 1-1h1a7 7 0 0 1 7-7h1V5.73c-.6-.34-1-.99-1-1.73a2 2 0 0 1 2-2'/%3E%3C/svg%3E";
    const defUser = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23888888'%3E%3Cpath d='M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z'/%3E%3C/svg%3E";

    // UI Elements
    const els = {
        imgRing: document.getElementById('prev-img-ring'),
        imgHead: document.getElementById('prev-img-head'),
        chatWin: document.getElementById('prev-chat'),
        msgs: document.getElementById('prev-msgs'),
        inp: document.getElementById('prev-in'),
        // Inputs
        file: document.getElementById('inp-img'),
        pdf: document.getElementById('inp-pdf'),
        pdfStatus: document.getElementById('status-pdf'),
        dict: document.getElementById('inp-dict'),
        unk: document.getElementById('inp-unknown'),
        wel: document.getElementById('inp-welcome'),
        acc: document.getElementById('inp-accent'),
        code: document.getElementById('output-code'),
        copy: document.getElementById('btn-copy'),
        label: document.getElementById('label-img')
    };

    let state = { avatar: defBot, isUser: false, open: false, pdfData: null, pdfName: "–ó–∞–¥–∞–Ω–∏–µ.pdf" };

    // Init
    els.imgRing.src = state.avatar;
    els.imgHead.src = state.avatar;
    
    // Default dictionary content
    els.dict.value = "–ó–∞–¥–∞–Ω–∏–µ 1 - –û—Ç–≤–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π\n–ü—Ä–∏–≤–µ—Ç - –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π!\n–ö–∞–∫ –¥–µ–ª–∞ - –û—Ç–ª–∏—á–Ω–æ";

    // Handlers
    els.file.onchange = e => {
        const f = e.target.files[0];
        if(f) {
            const r = new FileReader();
            r.onload = v => {
                state.avatar = v.target.result;
                state.isUser = true;
                els.imgRing.src = state.avatar;
                els.imgHead.src = state.avatar;
                els.label.innerText = "‚úÖ –ê–≤–∞—Ç–∞—Ä –∑–∞–≥—Ä—É–∂–µ–Ω";
                refreshChat();
            };
            r.readAsDataURL(f);
        }
    };

    els.pdf.onchange = e => {
        const f = e.target.files[0];
        if(f) {
            if(f.size > 2 * 1024 * 1024) {
                alert("–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –ú–∞–∫—Å–∏–º—É–º 2–ú–ë.");
                els.pdf.value = "";
                return;
            }
            const r = new FileReader();
            r.onload = v => {
                state.pdfData = v.target.result;
                state.pdfName = f.name;
                els.pdfStatus.innerText = "‚úÖ " + f.name + " –∑–∞–≥—Ä—É–∂–µ–Ω";
                els.pdfStatus.style.display = "block";
                refreshChat();
            };
            r.readAsDataURL(f);
        }
    }

    window.toggleChat = () => {
        state.open = !state.open;
        if(state.open) {
            els.chatWin.classList.add('open');
            if(els.msgs.children.length === 0) addWelcome();
        } else {
            els.chatWin.classList.remove('open');
        }
    };

    function addWelcome() {
        const div = document.createElement('div');
        div.className = `message msg-bot`;
        
        const img = document.createElement('img');
        img.className = 'msg-avatar';
        img.src = state.avatar;
        
        const contentDiv = document.createElement('div');
        contentDiv.style.display = 'flex';
        contentDiv.style.flexDirection = 'column';
        contentDiv.style.gap = '5px';

        // Text
        const bub = document.createElement('div');
        bub.className = 'bubble';
        bub.innerText = els.wel.value;
        contentDiv.appendChild(bub);

        // PDF Button if exists
        if(state.pdfData) {
            const pdfBtn = document.createElement('a');
            pdfBtn.className = 'bubble pdf-bubble';
            pdfBtn.innerText = "üìÑ –°–∫–∞—á–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ";
            // In preview we just show visual
            contentDiv.appendChild(pdfBtn);
        }

        div.appendChild(img);
        div.appendChild(contentDiv);
        els.msgs.appendChild(div);
    }

    function addMsg(role, text) {
        const div = document.createElement('div');
        div.className = `message msg-${role}`;
        
        const img = document.createElement('img');
        img.className = 'msg-avatar';
        img.src = role === 'bot' ? state.avatar : defUser;
        
        const bub = document.createElement('div');
        bub.className = 'bubble';
        if(role === 'user') bub.style.background = els.acc.value;
        bub.innerText = text;

        div.appendChild(img);
        div.appendChild(bub);
        
        if(role === 'user') { div.insertBefore(bub, img); }
        
        els.msgs.appendChild(div);
        els.msgs.scrollTop = els.msgs.scrollHeight;
    }

    function refreshChat() {
        els.msgs.innerHTML = '';
        if(state.open) addWelcome();
    }

    // Dictionary Parse
    function parseDictionary() {
        const lines = els.dict.value.split('\n');
        const db = {};
        lines.forEach(line => {
            const parts = line.split('-');
            if(parts.length >= 2) {
                const key = parts[0].trim().toLowerCase();
                const val = parts.slice(1).join('-').trim();
                if(key) db[key] = val;
            }
        });
        return db;
    }

    window.simSend = () => {
        const val = els.inp.value.trim();
        if(!val) return;
        addMsg('user', val);
        els.inp.value = '';
        
        const db = parseDictionary();
        const key = val.toLowerCase();
        let answer = db[key];
        
        if(!answer) answer = els.unk.value;
        
        setTimeout(() => addMsg('bot', answer), 400);
    };

    els.acc.oninput = () => {
        document.querySelector('.send-btn').style.background = els.acc.value;
        refreshChat();
    };
    els.wel.oninput = refreshChat;

    // Generate Code
    els.copy.onclick = () => {
        const code = getCode();
        els.code.value = code;
        els.code.select();
        document.execCommand('copy');
        els.copy.innerText = "‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!";
        setTimeout(() => els.copy.innerText = "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥", 2000);
    };

    function getCode() {
        const uid = "task-" + Math.random().toString(36).substr(2,6);
        const av = state.isUser ? state.avatar : defBot;
        const us = defUser;
        const col = els.acc.value;
        const wel = els.wel.value;
        const unk = els.unk.value;
        const pdf = state.pdfData || "";
        const pdfName = state.pdfName || "file.pdf";
        
        const dictObj = JSON.stringify(parseDictionary());

        // Embedded sounds (Short mechanical clicks)
        const sType = "data:audio/mp3;base64,//uQZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAWgAAAA0AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMmYXbWxpbmUAbXAzLjEwMKqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq"; // Silent placeholder for brevity, real sounds would make code longer.
        
        // Using Generic short beep Base64 for demo purposes to keep code light
        const soundClick = "data:audio/wav;base64,UklGRi4AAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAACAgEBAQAAAA==";
        const soundPop = "data:audio/wav;base64,UklGRjIAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoAAACAAAAAgAAAAAA=";

        return `
<!DOCTYPE html>
<html>
<head><meta charset="utf-8"></head>
<body style="margin:0;padding:0;width:100%;height:100%;background:transparent;overflow:hidden;font-family:sans-serif;">
<style>
* { box-sizing: border-box; }
#${uid} { width:100%; height:100%; display:flex; justify-content:center; align-items:center; position:relative; }

/* Ring */
#${uid} .ring { width:90px; height:90px; border-radius:50%; background:#1E1234; border:3px solid rgba(255,255,255,0.3); cursor:pointer; display:flex; justify-content:center; align-items:center; box-shadow:0 5px 15px rgba(0,0,0,0.4); transition:0.3s; z-index:1; }
#${uid} .ring:hover { transform:scale(1.05); }
#${uid} .ring img { width:90%; height:90%; border-radius:50%; object-fit:cover; }

/* Chat */
#${uid} .win { position:absolute; width:98%; height:98%; background:#120C1C; border-radius:15px; border:1px solid #3A2E59; display:flex; flex-direction:column; box-shadow:0 10px 30px rgba(0,0,0,0.6); opacity:0; pointer-events:none; transform:scale(0.9); transition:0.3s; z-index:2; color:#fff; }
#${uid} .win.show { opacity:1; pointer-events:all; transform:scale(1); }

#${uid} .head { padding:10px; background:rgba(255,255,255,0.05); border-bottom:1px solid #3A2E59; display:flex; justify-content:space-between; align-items:center; }
#${uid} .prof { display:flex; align-items:center; gap:8px; font-size:14px; font-weight:bold; }
#${uid} .prof img { width:30px; height:30px; border-radius:50%; object-fit:cover; }
#${uid} .cls { background:none; border:none; color:#888; font-size:20px; cursor:pointer; }

#${uid} .logs { flex:1; padding:10px; overflow-y:auto; display:flex; flex-direction:column; gap:10px; scrollbar-width:thin; }
#${uid} .row { display:flex; gap:6px; max-width:90%; align-items:flex-end; font-size:13px; line-height:1.4; }
#${uid} .bot { align-self:flex-start; }
#${uid} .usr { align-self:flex-end; flex-direction:row-reverse; }
#${uid} .av { width:24px; height:24px; border-radius:50%; object-fit:cover; flex-shrink:0; }
#${uid} .cnt { display:flex; flex-direction:column; gap:4px; max-width:100%; }
#${uid} .txt { padding:8px 12px; border-radius:15px; word-wrap:break-word; }
#${uid} .bot .txt { background:rgba(255,255,255,0.1); border-bottom-left-radius:2px; }
#${uid} .usr .txt { background:${col}; color:#fff; border-bottom-right-radius:2px; }

/* PDF Button */
#${uid} .pdf { display:flex; align-items:center; gap:8px; background:#3A2E59; border:1px solid ${col}; color:white; text-decoration:none; font-weight:bold; cursor:pointer; transition:0.2s; }
#${uid} .pdf:hover { background:${col}; }

#${uid} .inp { padding:8px; background:rgba(0,0,0,0.2); border-top:1px solid #3A2E59; display:flex; gap:6px; }
#${uid} input { flex:1; background:#0b0711; border:1px solid #3A2E59; border-radius:20px; padding:8px 12px; color:#fff; outline:none; }
#${uid} .snd { width:34px; height:34px; border-radius:50%; background:${col}; border:none; color:#fff; cursor:pointer; display:flex; justify-content:center; align-items:center; }
#${uid} .snd svg { width:16px; fill:white; margin-left:2px; }
</style>

<div id="${uid}">
    <div class="ring" id="r-${uid}"><img src="${av}"></div>
    <div class="win" id="w-${uid}">
        <div class="head">
            <div class="prof"><img src="${av}"><span>–ê–≤–∞—Ç–∞—Ä</span></div>
            <button class="cls" id="c-${uid}">√ó</button>
        </div>
        <div class="logs" id="l-${uid}"></div>
        <div class="inp">
            <input type="text" id="i-${uid}" placeholder="–ù–∞–ø–∏—à–∏ –æ—Ç–≤–µ—Ç...">
            <button class="snd" id="s-${uid}"><svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg></button>
        </div>
    </div>
    <audio id="aud-clk-${uid}" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>
    <audio id="aud-pop-${uid}" src="https://assets.mixkit.co/active_storage/sfx/2346/2346-preview.mp3"></audio>
</div>

<script>
(function(){
    var r = document.getElementById('r-${uid}');
    var w = document.getElementById('w-${uid}');
    var c = document.getElementById('c-${uid}');
    var l = document.getElementById('l-${uid}');
    var i = document.getElementById('i-${uid}');
    var s = document.getElementById('s-${uid}');
    
    // Sounds
    var sClk = document.getElementById('aud-clk-${uid}'); // Typewriter
    var sPop = document.getElementById('aud-pop-${uid}'); // Send/Pop

    var db = ${dictObj};
    var pdf = "${pdf}";
    var start = false;

    // Open/Close
    r.onclick = function(){ w.classList.add('show'); r.style.opacity='0'; r.style.pointerEvents='none'; if(!start){ init(); start=true; } };
    c.onclick = function(){ w.classList.remove('show'); r.style.opacity='1'; r.style.pointerEvents='all'; };

    function init() {
        var d = mkRow('bot');
        var cnt = d.querySelector('.cnt');
        
        // Welcome Text
        var t = document.createElement('div'); t.className='txt'; t.innerText = "${wel}";
        cnt.appendChild(t);

        // PDF Button
        if(pdf) {
            var b = document.createElement('a'); 
            b.className='txt pdf'; 
            b.href = pdf; 
            b.download = "${pdfName}";
            b.innerHTML = '<span>üìÑ –°–∫–∞—á–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ</span>';
            cnt.appendChild(b);
        }
        l.appendChild(d);
        sPop.play().catch(e=>{});
    }

    function mkRow(who) {
        var d = document.createElement('div'); d.className = 'row ' + who;
        var im = document.createElement('img'); im.className = 'av'; im.src = who==='bot'?"${av}":"${us}";
        var c = document.createElement('div'); c.className = 'cnt';
        d.appendChild(im); d.appendChild(c);
        if(who==='usr') { d.insertBefore(c, im); }
        return d;
    }

    function addTxt(who, txt) {
        var d = mkRow(who);
        var t = document.createElement('div'); t.className='txt'; t.innerText=txt;
        d.querySelector('.cnt').appendChild(t);
        l.appendChild(d); l.scrollTop = l.scrollHeight;
    }

    function send() {
        var v = i.value.trim();
        if(!v) return;
        
        // Play Typewriter Sound on send
        sClk.currentTime = 0;
        sClk.play().catch(e=>{});

        addTxt('usr', v);
        i.value = '';
        
        var key = v.toLowerCase();
        var ans = db[key];
        if(!ans) {
            var found = Object.keys(db).find(k => k.includes(key) || key.includes(k));
            if(found) ans = db[found];
        }
        if(!ans) ans = "${unk}";

        setTimeout(function(){ 
            addTxt('bot', ans); 
            sPop.currentTime = 0;
            sPop.play().catch(e=>{});
        }, 500);
    }

    s.onclick = send;
    i.onkeypress = function(e){ if(e.key==='Enter') send(); };
})();
<\/script>
</body>
</html>`;
    }
</script>
</body>
</html>
