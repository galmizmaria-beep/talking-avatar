<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ê–≤–∞—Ç–∞—Ä–∞ –¥–ª—è Genially</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --bg: #120C1C; --surface: #1E1234; --primary: #A450F3; --accent: #F72585; --text: #EAE2FF; --border: #3A2E59; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        #editor-container { max-width: 950px; width: 100%; background-color: var(--surface); padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid var(--border); }
        h1 { text-align: center; margin-bottom: 30px; text-shadow: 0 0 10px var(--accent); }
        .editor-layout { display: flex; flex-wrap: wrap; gap: 30px; }
        .col { flex: 1; min-width: 320px; padding: 20px; background: rgba(0,0,0,0.2); border-radius: 15px; border: 1px solid var(--border); }
        
        /* Preview Styles */
        #preview-box { height: 350px; display: flex; justify-content: center; align-items: center; position: relative; }
        #avatar-wrapper { width: 250px; height: 250px; position: relative; transition: all 0.3s; display: flex; justify-content: center; align-items: center; }
        #avatar-img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 4px solid var(--border); display: none; box-shadow: 0 5px 15px rgba(0,0,0,0.5); }
        #placeholder { border: 2px dashed var(--border); border-radius: 50%; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: #aaa; text-align: center; }
        
        /* Controls */
        .p-controls { display: flex; justify-content: center; gap: 20px; margin-top: 20px; }
        .p-btn { background: none; border: none; color: white; cursor: pointer; transition: 0.3s; opacity: 0.7; }
        .p-btn:hover { opacity: 1; transform: scale(1.1); }
        .play-main { width: 60px; height: 60px; background: linear-gradient(145deg, var(--primary), var(--accent)); border-radius: 50%; display: flex; align-items: center; justify-content: center; opacity: 1; box-shadow: 0 0 15px var(--primary); }
        .p-btn svg { width: 30px; height: 30px; }

        /* Inputs */
        .file-input { display: none; }
        .custom-file { display: block; padding: 12px; background: var(--bg); border: 1px dashed var(--border); text-align: center; cursor: pointer; margin-bottom: 15px; border-radius: 8px; transition: 0.3s; }
        .custom-file:hover { border-color: var(--primary); }
        .label-text { display: block; margin-bottom: 5px; font-weight: 600; font-size: 0.9em; }
        
        /* Action Buttons */
        .actions { margin-top: 30px; display: flex; flex-direction: column; gap: 15px; align-items: center; }
        .btn { padding: 12px 25px; border: none; border-radius: 50px; font-weight: 600; cursor: pointer; transition: 0.3s; width: 100%; max-width: 400px; font-size: 1rem; }
        #btn-copy { background: linear-gradient(90deg, #A450F3, #F72585); color: white; box-shadow: 0 0 15px var(--primary); }
        #btn-download { background: transparent; border: 2px solid var(--border); color: var(--text); }
        .btn:hover { transform: translateY(-2px); filter: brightness(1.2); }
        
        textarea { width: 100%; height: 100px; background: #0b0711; border: 1px solid var(--border); color: #888; margin-top: 15px; border-radius: 8px; padding: 10px; font-family: monospace; font-size: 12px; resize: none; }
    </style>
</head>
<body>

<div id="editor-container">
    <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –í–∏–¥–∂–µ—Ç–∞</h1>
    
    <div class="editor-layout">
        <!-- Preview Column -->
        <div class="col">
            <h3 style="text-align:center">–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</h3>
            <div id="preview-box">
                <div id="avatar-wrapper">
                    <div id="placeholder">–ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</div>
                    <img id="avatar-img">
                </div>
            </div>
            <div class="p-controls">
                <button class="p-btn" id="prev"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"/></svg></button>
                <button class="p-btn play-main" id="play"></button>
                <button class="p-btn" id="next"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"/></svg></button>
            </div>
        </div>

        <!-- Settings Column -->
        <div class="col">
            <h3 style="text-align:center">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
            
            <label class="custom-file">
                <span id="img-name">üìÇ –ó–∞–≥—Ä—É–∑–∏—Ç—å –ö–∞—Ä—Ç–∏–Ω–∫—É</span>
                <input type="file" id="inp-img" accept="image/*" class="file-input">
            </label>
            
            <label class="custom-file">
                <span id="aud-name">üéµ –ó–∞–≥—Ä—É–∑–∏—Ç—å –ê—É–¥–∏–æ</span>
                <input type="file" id="inp-aud" accept="audio/*,video/mp4" class="file-input">
            </label>

            <span class="label-text">–†–∞–∑–º–µ—Ä: <span id="val-size">250px</span></span>
            <input type="range" id="rng-size" min="150" max="400" value="250" style="width:100%">
            
            <span class="label-text" style="margin-top:10px">–¶–≤–µ—Ç —Å–≤–µ—á–µ–Ω–∏—è:</span>
            <input type="color" id="inp-color" value="#F72585" style="width:100%; height:40px; border:none; background:none;">
            
            <span class="label-text" style="margin-top:10px">–°–∏–ª–∞ —Å–≤–µ—á–µ–Ω–∏—è:</span>
            <input type="range" id="rng-glow" min="1" max="20" value="10" style="width:100%">
        </div>
    </div>

    <div class="actions">
        <button id="btn-copy" class="btn">üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ (–¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ Embed)</button>
        <button id="btn-download" class="btn">üíæ –°–∫–∞—á–∞—Ç—å HTML —Ñ–∞–π–ª (–¥–ª—è —Å—Å—ã–ª–∫–∏ GitHub)</button>
        <textarea id="output-code" readonly placeholder="–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –∫–æ–¥..."></textarea>
    </div>
</div>

<audio id="main-audio" style="display:none"></audio>

<script>
    // Elements
    const els = {
        imgInp: document.getElementById('inp-img'),
        audInp: document.getElementById('inp-aud'),
        imgName: document.getElementById('img-name'),
        audName: document.getElementById('aud-name'),
        avatarImg: document.getElementById('avatar-img'),
        placeholder: document.getElementById('placeholder'),
        wrapper: document.getElementById('avatar-wrapper'),
        audio: document.getElementById('main-audio'),
        playBtn: document.getElementById('play'),
        sizeRng: document.getElementById('rng-size'),
        colorInp: document.getElementById('inp-color'),
        glowRng: document.getElementById('rng-glow'),
        outArea: document.getElementById('output-code'),
        btnCopy: document.getElementById('btn-copy'),
        btnDown: document.getElementById('btn-download')
    };

    let state = { img: '', audio: '' };
    const icons = {
        play: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>',
        pause: '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>'
    };
    els.playBtn.innerHTML = icons.play;

    // Functions
    const read = (file, type) => {
        const reader = new FileReader();
        reader.onload = e => {
            state[type] = e.target.result;
            if(type === 'img') {
                els.avatarImg.src = state.img;
                els.avatarImg.style.display = 'block';
                els.placeholder.style.display = 'none';
            } else {
                els.audio.src = state.audio;
            }
        };
        reader.readAsDataURL(file);
    };

    const updatePreview = () => {
        const size = els.sizeRng.value;
        const color = els.colorInp.value;
        const glow = els.glowRng.value;
        
        document.getElementById('val-size').innerText = size + 'px';
        els.wrapper.style.width = size + 'px';
        els.wrapper.style.height = size + 'px';
        
        // Dynamic CSS var update for preview logic handled by class
        const shadow = `0 0 ${glow * 1.5}px ${color}`;
        if(!els.audio.paused) els.wrapper.style.filter = `drop-shadow(${shadow})`;
        else els.wrapper.style.filter = 'none';
    };

    // Listeners
    els.imgInp.onchange = e => { 
        if(e.target.files[0]) {
            read(e.target.files[0], 'img'); 
            els.imgName.innerText = '‚úÖ ' + e.target.files[0].name;
        }
    };
    els.audInp.onchange = e => { 
        if(e.target.files[0]) {
            read(e.target.files[0], 'audio'); 
            els.audName.innerText = '‚úÖ ' + e.target.files[0].name;
        }
    };
    [els.sizeRng, els.colorInp, els.glowRng].forEach(el => el.oninput = updatePreview);
    
    // Audio Logic
    const toggle = () => els.audio.paused ? els.audio.play() : els.audio.pause();
    els.playBtn.onclick = toggle;
    els.wrapper.onclick = toggle;
    els.audio.onplay = () => { els.playBtn.innerHTML = icons.pause; updatePreview(); };
    els.audio.onpause = () => { els.playBtn.innerHTML = icons.play; updatePreview(); };
    els.audio.onended = () => { els.playBtn.innerHTML = icons.play; updatePreview(); };

    // GENERATOR CORE
    const generateHTML = () => {
        if(!state.img || !state.audio) { alert('–°–Ω–∞—á–∞–ª–∞ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –∫–∞—Ä—Ç–∏–Ω–∫—É –∏ –∞—É–¥–∏–æ!'); return null; }
        
        const uid = 'w-' + Math.random().toString(36).substr(2, 9);
        const size = els.sizeRng.value;
        const color = els.colorInp.value;
        const glow = els.glowRng.value * 1.5;

        return `
<div id="${uid}" style="width:100%;height:100%;display:flex;justify-content:center;align-items:center;background:transparent;font-family:sans-serif;">
<style>
#${uid} .av-wrap { width:${size}px; height:${size}px; border-radius:50%; position:relative; transition:filter 0.3s; cursor:pointer; padding:5px; }
#${uid} .av-wrap.speak { filter: drop-shadow(0 0 ${glow}px ${color}); }
#${uid} img { width:100%; height:100%; border-radius:50%; object-fit:cover; display:block; }
#${uid} .ctrls { display:flex; gap:15px; margin-top:10px; justify-content:center; width:100%; }
#${uid} btn { background:none; border:none; cursor:pointer; color:white; opacity:0.8; transition:0.3s; }
#${uid} btn:hover { transform:scale(1.1); opacity:1; }
#${uid} .p-main { width:50px; height:50px; background:linear-gradient(145deg, #a960ec, #f72585); border-radius:50%; display:flex; align-items:center; justify-content:center; box-shadow:0 4px 10px rgba(0,0,0,0.3); }
#${uid} svg { width:28px; height:28px; filter:drop-shadow(0 2px 4px rgba(0,0,0,0.5)); }
</style>
<div style="display:flex;flex-direction:column;align-items:center;">
    <div class="av-wrap"><img src="${state.img}"></div>
    <div class="ctrls">
        <btn class="b-prev"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M11 18V6l-8.5 6 8.5 6zm.5-6l8.5 6V6l-8.5 6z"/></svg></btn>
        <btn class="p-main"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg></btn>
        <btn class="b-next"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 18l8.5-6L4 6v12zm9-12v12l8.5-6L13 6z"/></svg></btn>
    </div>
    <audio src="${state.audio}" style="display:none"></audio>
</div>
<script>
(function(){
    var root = document.getElementById('${uid}');
    var a = root.querySelector('audio'), w = root.querySelector('.av-wrap'), p = root.querySelector('.p-main');
    var iPlay = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>';
    var iPause = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>';
    var t = () => a.paused ? a.play() : a.pause();
    p.onclick = w.onclick = t;
    root.querySelector('.b-prev').onclick = () => a.currentTime = Math.max(0, a.currentTime - 5);
    root.querySelector('.b-next').onclick = () => a.currentTime += 5;
    a.onplay = () => { p.innerHTML = iPause; w.classList.add('speak'); };
    a.onpause = () => { p.innerHTML = iPlay; w.classList.remove('speak'); };
    a.onended = () => { p.innerHTML = iPlay; w.classList.remove('speak'); };
})();
<\/script>
</div>`;
    };

    // Button Actions
    els.btnCopy.onclick = () => {
        const code = generateHTML();
        if(!code) return;
        els.outArea.value = code;
        els.outArea.select();
        
        try {
            document.execCommand('copy');
            els.btnCopy.innerText = "‚úÖ –ö–æ–¥ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω! –í—Å—Ç–∞–≤—å—Ç–µ –≤ Genially (Insert > Others)";
        } catch(e) {
            els.btnCopy.innerText = "‚ùå –û—à–∏–±–∫–∞ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è. –ù–∞–∂–º–∏—Ç–µ Ctrl+C";
        }
        setTimeout(() => els.btnCopy.innerText = "üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ (–¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ Embed)", 4000);
    };

    els.btnDown.onclick = () => {
        const code = generateHTML();
        if(!code) return;
        
        // Create a standalone HTML file
        const fullPage = `<!DOCTYPE html><html><body style="margin:0;background:transparent;display:flex;justify-content:center;align-items:center;min-height:100vh">${code}</body></html>`;
        
        const blob = new Blob([fullPage], {type: 'text/html'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = "my-avatar-widget.html";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        els.btnDown.innerText = "‚úÖ –§–∞–π–ª —Å–∫–∞—á–∞–Ω! –ó–∞–≥—Ä—É–∑–∏—Ç–µ –µ–≥–æ –Ω–∞ GitHub";
        setTimeout(() => els.btnDown.innerText = "üíæ –°–∫–∞—á–∞—Ç—å HTML —Ñ–∞–π–ª (–¥–ª—è —Å—Å—ã–ª–∫–∏ GitHub)", 4000);
    };
</script>
</body>
</html>
